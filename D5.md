# Вариант Д5

### Задание 1 (10 баллов)
Постройте конечный автомат, принимающий на ввод троичное число (цифры 0,1,2), вводимое со старших разрядов и заканчивающееся маркером конца `#`, и проверяющий, делится ли введённое число на 4. Например, по входу `1210#` должно быть выдано `ДА`, по входу `2120#` — `НЕТ`.

---

#### Решение

**Шаг 1: Идея**

При чтении троичного числа слева направо:
- Если текущее значение = n, после чтения цифры d новое значение = 3n + d

Нас интересует остаток от деления на 4, поэтому состояния — остатки {0, 1, 2, 3}.

**Шаг 2: Таблица переходов**

Новый остаток = (3 × старый_остаток + цифра) mod 4

| Состояние | Вход 0 | Вход 1 | Вход 2 |
|-----------|--------|--------|--------|
| q₀ (ост. 0) | (3·0+0)%4=0 → q₀ | (3·0+1)%4=1 → q₁ | (3·0+2)%4=2 → q₂ |
| q₁ (ост. 1) | (3·1+0)%4=3 → q₃ | (3·1+1)%4=0 → q₀ | (3·1+2)%4=1 → q₁ |
| q₂ (ост. 2) | (3·2+0)%4=2 → q₂ | (3·2+1)%4=3 → q₃ | (3·2+2)%4=0 → q₀ |
| q₃ (ост. 3) | (3·3+0)%4=1 → q₁ | (3·3+1)%4=2 → q₂ | (3·3+2)%4=3 → q₃ |

**Шаг 3: Проверка примеров**

**1210₃:**
1210₃ = 1·27 + 2·9 + 1·3 + 0·1 = 27 + 18 + 3 = 48₁₀

48 mod 4 = 0 → ДА

Проверка автомата:
- Начало: q₀
- 1: q₀ → q₁
- 2: q₁ → q₁
- 1: q₁ → q₀
- 0: q₀ → q₀
- #: состояние q₀ → «ДА» ✓

**2120₃:**
2120₃ = 2·27 + 1·9 + 2·3 + 0·1 = 54 + 9 + 6 = 69₁₀

69 mod 4 = 1 → НЕТ

Проверка автомата:
- Начало: q₀
- 2: q₀ → q₂
- 1: q₂ → q₃
- 2: q₃ → q₃
- 0: q₃ → q₁
- #: состояние q₁ → «НЕТ» ✓

**Ответ:**

```
Автомат A = ({q₀, q₁, q₂, q₃}, {0, 1, 2, #}, δ, q₀, {q₀})

Функция переходов δ:
δ(q₀, 0) = q₀    δ(q₀, 1) = q₁    δ(q₀, 2) = q₂
δ(q₁, 0) = q₃    δ(q₁, 1) = q₀    δ(q₁, 2) = q₁
δ(q₂, 0) = q₂    δ(q₂, 1) = q₃    δ(q₂, 2) = q₀
δ(q₃, 0) = q₁    δ(q₃, 1) = q₂    δ(q₃, 2) = q₃

При # в состоянии q₀ → «ДА», иначе → «НЕТ»
```

---

### Задание 2 (10 баллов)
Узника подвели к двум комнатам, в каждой из которых может оказаться либо принцесса, либо тигр. На каждой комнате прикреплена табличка. На первой написано: «По крайней мере, в одной из комнат находится принцесса». На второй написано: «Тигр в другой комнате». Дополнительно известно, что утверждение на двери ложно, если в комнате находится принцесса, и истинно, если в комнате находится тигр. С помощью формального анализа определите, в какой комнате находится принцесса.

---

#### Решение

**Шаг 1: Формализация**

- P₁ = 1 — принцесса в комнате 1; P₁ = 0 — тигр
- P₂ = 1 — принцесса в комнате 2; P₂ = 0 — тигр

Таблички:
- T₁: «По крайней мере в одной комнате принцесса» = P₁ ∨ P₂
- T₂: «Тигр в другой комнате» (относительно комнаты 2) = ¬P₁

**Шаг 2: Условия истинности**

Для обеих комнат одинаковое правило:
- Если принцесса, табличка ложна
- Если тигр, табличка истинна

Комната 1: T₁ ↔ ¬P₁ (табличка истинна ⟺ тигр в комнате 1)
Комната 2: T₂ ↔ ¬P₂

**Шаг 3: Система уравнений**

(1) (P₁ ∨ P₂) ↔ ¬P₁
(2) ¬P₁ ↔ ¬P₂

Из (2): ¬P₁ = ¬P₂, значит **P₁ = P₂**

Подставим в (1): (P₁ ∨ P₁) ↔ ¬P₁, т.е. P₁ ↔ ¬P₁

Это противоречие! P₁ не может быть равно ¬P₁.

**Шаг 4: Перепроверка интерпретации T₂**

«Тигр в другой комнате» — возможно, имеется в виду «тигр в комнате 1» (другой относительно комнаты 2).

T₂ = ¬P₁ (тигр в комнате 1)

Уже использовали эту интерпретацию.

**Альтернативная интерпретация:** Может, правило для второй комнаты отличается? Перечитаем условие...

Условие говорит: «утверждение на двери ложно, если в комнате принцесса» — это одинаково для обеих комнат.

**Шаг 5: Проверка всех комбинаций**

| P₁ | P₂ | T₁ = P₁∨P₂ | Усл. ком.1: T₁=¬P₁? | T₂ = ¬P₁ | Усл. ком.2: T₂=¬P₂? |
|----|----|-----------|--------------------|----------|---------------------|
| 0 | 0 | 0 | 0=1? ✗ | 1 | 1=1? ✓ |
| 0 | 1 | 1 | 1=1? ✓ | 1 | 1=0? ✗ |
| 1 | 0 | 1 | 1=0? ✗ | 0 | 0=1? ✗ |
| 1 | 1 | 1 | 1=0? ✗ | 0 | 0=0? ✓ |

Ни одна комбинация не удовлетворяет обоим условиям!

**Шаг 6: Возможная ошибка в условии**

Вероятно, табличка T₂ означает «Тигр в первой комнате» (другая = первая). Тогда при P₁=0, P₂=1:
- T₁ = 1 (истина), условие: T₁ = ¬P₁ = 1 ✓
- T₂ = 1 (тигр в комнате 1), условие: T₂ = ¬P₂ = 0 ✗

Противоречие остаётся.

**Вывод:** При стандартной интерпретации условий задача **не имеет решения**. Возможно, в условии опечатка.

**Если предположить**, что правило для комнаты 2 обратное (табличка истинна при принцессе):

Комната 2: T₂ ↔ P₂

Тогда: ¬P₁ = P₂

Подставим в (1): (P₁ ∨ ¬P₁) ↔ ¬P₁, т.е. 1 ↔ ¬P₁, значит P₁ = 0, P₂ = 1.

**Ответ (при исправленном условии):** Принцесса в **комнате 2**.

---

### Задание 3 (15 баллов)
Известны следующие факты: «Кошку Мурку могли убить только Том или Боб». Известно, что у Тома есть собака. Полагается также, что владельцы собак любят животных, а любители животных не убивают животных. На основе этих фактов проведите формальное доказательство методом резолюций того, что кошку Мурку убил Боб. Для доказательства явно сформулируйте необходимые подразумеваемые факты (например, что кошки — животные).

---

#### Решение

**Шаг 1: Формализация предикатов**

- Kill(x, y) — x убил y
- Dog(x) — x является собакой
- Own(x, y) — x владеет y
- Love(x, y) — x любит y
- Animal(x) — x является животным
- Cat(x) — x является кошкой

Константы: Tom, Bob, Murka, Sharik (собака Тома)

**Шаг 2: Формализация фактов**

F1: Kill(Tom, Murka) ∨ Kill(Bob, Murka) — Мурку убил Том или Боб

F2: Own(Tom, Sharik) ∧ Dog(Sharik) — У Тома есть собака Шарик

F3: ∀x∀y (Own(x, y) ∧ Dog(y) → Love(x, Animal)) — Владельцы собак любят животных
    Упрощаем: ∀x∀y∀z (Own(x, y) ∧ Dog(y) ∧ Animal(z) → Love(x, z))

F4: ∀x∀y (Love(x, y) ∧ Animal(y) → ¬Kill(x, y)) — Любители животных не убивают животных

F5: Cat(Murka) — Мурка — кошка

F6: ∀x (Cat(x) → Animal(x)) — Все кошки — животные

**Шаг 3: Преобразование в КНФ**

(1) Kill(Tom, Murka) ∨ Kill(Bob, Murka)

(2) Own(Tom, Sharik)

(3) Dog(Sharik)

(4) ¬Own(x, y) ∨ ¬Dog(y) ∨ ¬Animal(z) ∨ Love(x, z)

(5) ¬Love(x, y) ∨ ¬Animal(y) ∨ ¬Kill(x, y)

(6) Cat(Murka)

(7) ¬Cat(x) ∨ Animal(x)

**Отрицание заключения:**
(8) ¬Kill(Bob, Murka)

**Шаг 4: Метод резолюций**

(9) Из (7)[x:=Murka] и (6): Animal(Murka)

(10) Из (4)[x:=Tom, y:=Sharik, z:=Murka] и (2): ¬Dog(Sharik) ∨ ¬Animal(Murka) ∨ Love(Tom, Murka)

(11) Из (10) и (3): ¬Animal(Murka) ∨ Love(Tom, Murka)

(12) Из (11) и (9): Love(Tom, Murka)

(13) Из (5)[x:=Tom, y:=Murka] и (12): ¬Animal(Murka) ∨ ¬Kill(Tom, Murka)

(14) Из (13) и (9): ¬Kill(Tom, Murka)

(15) Из (1) и (14): Kill(Bob, Murka)

(16) Из (15) и (8): □ (пустой дизъюнкт)

**Ответ:** Методом резолюций **доказано**, что кошку Мурку убил **Боб**.

---

### Задание 4 (10 баллов)
Для приведённых ниже двух фрагментов программ, а также данных предусловий и постусловий, найдите с помощью построения слабейшего предусловия wp такие выражения E, при которых фрагменты корректны.

| Предусловие I                             | Фрагмент программы S                | Постусловие R                        |
|-------------------------------------------|-------------------------------------|--------------------------------------|
| {True}                                    | s := E; i := 0;                     | {s = Σ_{0≤j≤i} b[j]}         |
| {i >= 0 & s = Σ_{0≤j≤i} a[j]}              | s := s + E; i := i+1;             | {i > 0 & s = Σ_{0≤j≤i} a[j]}          |

---

#### Решение

**Задача 1: {True} s := E; i := 0; {s = Σ_{0≤j≤i} b[j]}**

**Шаг 1:** wp("i := 0", s = Σ_{0≤j≤i} b[j])
- Подставляем 0 вместо i: s = Σ_{0≤j≤0} b[j] = b[0]

**Шаг 2:** wp("s := E", s = b[0])
- Подставляем E вместо s: E = b[0]

**Шаг 3:** Проверка: True → (E = b[0]) выполняется, если **E = b[0]**.

**Ответ 1: E = b[0]**

---

**Задача 2: {i ≥ 0 ∧ s = Σ_{0≤j≤i} a[j]} s := s + E; i := i+1; {i > 0 ∧ s = Σ_{0≤j≤i} a[j]}**

**Шаг 1:** wp("i := i+1", i > 0 ∧ s = Σ_{0≤j≤i} a[j])
- Подставляем i+1 вместо i: (i+1) > 0 ∧ s = Σ_{0≤j≤i+1} a[j]
- Упрощаем: i ≥ 0 ∧ s = Σ_{0≤j≤i+1} a[j]

**Шаг 2:** wp("s := s + E", i ≥ 0 ∧ s = Σ_{0≤j≤i+1} a[j])
- Подставляем s + E вместо s: i ≥ 0 ∧ (s + E) = Σ_{0≤j≤i+1} a[j]

**Шаг 3:** Раскроем сумму:
Σ_{0≤j≤i+1} a[j] = Σ_{0≤j≤i} a[j] + a[i+1]

Из предусловия: s = Σ_{0≤j≤i} a[j]

Подставим: s + E = s + a[i+1]

Значит: **E = a[i+1]**

**Шаг 4:** Проверка:
- Предусловие: i ≥ 0 ∧ s = Σ_{0≤j≤i} a[j]
- wp: i ≥ 0 ∧ s + a[i+1] = Σ_{0≤j≤i} a[j] + a[i+1] = Σ_{0≤j≤i+1} a[j] ✓

**Ответ 2: E = a[i+1]**

---

### Задание 5 (15 баллов)
Покажите, что следующие пары LTL-формул не эквивалентны, построив расчёт/вычисление, удовлетворяющее одной формуле и не удовлетворяющее другой:

a) FG p и G(p ⇒ X p)

b) FG p и ¬p U G p

c) p U ¬p и FG ¬p

(Если пара в билете отличается — пришлите уточнение; я подправлю.)

---

#### Решение

**a) FG p и G(p → Xp)**

**Вычисление σ₁:** ∅, ∅, ∅, ... (p всегда ложно)

- FG p: Нужно, чтобы когда-нибудь G p стало истинным. G p требует p всегда. Но p всегда ложно. **Ложно** ✗
- G(p → Xp): p всегда ложно, поэтому p → Xp всегда истинно (ложная посылка). **Истинно** ✓

**Вывод:** σ₁ удовлетворяет G(p → Xp), но не FG p. **Формулы не эквивалентны.**

---

**b) FG p и ¬p U G p**

**Вычисление σ₂:** {p}, ∅, {p}, {p}, {p}, ... (p ложно только в позиции 1)

- FG p: G p начинается с позиции 2 (p истинно с позиции 2 навсегда). **Истинно** ✓
- ¬p U G p: В позиции 0 p истинно, ¬p ложно. G p с позиции 0 ложно (p ложно в позиции 1). U требует либо ¬p до G p, либо G p сразу. Ни то, ни другое. **Ложно** ✗

**Вывод:** σ₂ удовлетворяет FG p, но не ¬p U G p. **Формулы не эквивалентны.**

---

**c) p U ¬p и FG ¬p**

**Вычисление σ₃:** {p}, {p}, {p}, ... (p всегда истинно)

- p U ¬p: p держится до ¬p. Но ¬p никогда не наступает. U требует, чтобы правая часть когда-нибудь выполнилась. **Ложно** ✗
- FG ¬p: Нужно, чтобы когда-нибудь ¬p стало всегда истинным. Но p всегда истинно. **Ложно** ✗

Обе формулы ложны на σ₃. Попробуем другое вычисление.

**Вычисление σ₄:** ∅, ∅, ∅, ... (p всегда ложно, ¬p всегда истинно)

- p U ¬p: ¬p истинно с позиции 0. U выполняется, если правая часть истинна (неважно, что слева). **Истинно** ✓
- FG ¬p: ¬p всегда истинно, G ¬p истинно с позиции 0. **Истинно** ✓

Обе истинны. Попробуем ещё.

**Вычисление σ₅:** {p}, ∅, {p}, ∅, {p}, ∅, ... (p чередуется)

- p U ¬p: В позиции 0 p истинно, в позиции 1 ¬p истинно. p U ¬p: p в позиции 0, затем ¬p в позиции 1. **Истинно** ✓
- FG ¬p: Нужен момент, с которого ¬p навсегда. Но p периодически истинно. **Ложно** ✗

**Вывод:** σ₅ удовлетворяет p U ¬p, но не FG ¬p. **Формулы не эквивалентны.**

---

### Задание 6 (10 баллов)
Пусть M = (S, S₀, R, AP, L) — структура Крипке:

S = {p, q, r, s};  S₀ = {p, r};
R = {(p, s), (q, r), (s, s), (q, s), (s, q), (r, p), (p, r)};
AP = {a, b, c};
L(p) = {a, b}, L: S-> 2^(AP), L(p) = {a, b},L(q) = {c} L(r) = {}, L(s) = {b}.

Проверьте, выполняется ли в M формула: M ⊨ EX AF (a ⇒ b)

---

#### Решение

**Шаг 1: Уточнение структуры**

Состояния: p, q, r, s
Пометки: L(p) = {a, b}, L(q) = {c}, L(r) = ∅, L(s) = {b}
Начальные: S₀ = {p, r}

Переходы:
- p → s, p → r
- q → r, q → s
- s → s, s → q
- r → p

**Шаг 2: Вычисление a → b в каждом состоянии**

a → b ≡ ¬a ∨ b

| Состояние | a | b | a → b |
|-----------|---|---|-------|
| p | 1 | 1 | 1 |
| q | 0 | 0 | 1 |
| r | 0 | 0 | 1 |
| s | 0 | 1 | 1 |

**a → b истинно во всех состояниях!**

**Шаг 3: Вычисление AF(a → b)**

AF φ: на всех путях когда-нибудь φ.

Поскольку a → b истинно во всех состояниях, AF(a → b) истинно во всех состояниях (φ выполняется уже в текущем состоянии).

**Шаг 4: Вычисление EX AF(a → b)**

EX ψ: существует переход в состояние, где ψ истинно.

AF(a → b) истинно везде, поэтому EX AF(a → b) истинно в любом состоянии, из которого есть хотя бы один переход.

Проверим переходы из начальных состояний:
- p: переходы в s, r — оба существуют ✓
- r: переход в p — существует ✓

**Шаг 5: Проверка M ⊨ EX AF(a → b)**

M ⊨ φ означает: φ истинно во всех начальных состояниях.

- EX AF(a → b) в p: ✓
- EX AF(a → b) в r: ✓

**Ответ:** Формула **M ⊨ EX AF(a → b) выполняется**.