# Вариант P15

(Σ 70 баллов)

### Задание 1 (15 баллов)
Сколько вершин содержит BDD булевой функции

F_n = ∧_{i=1}^n (x_i ⇒ y_i)

для разных n при двух различных порядках переменных:

a) x_1 < y_1 < x_2 < y_2 < …

b) x_1 < x_2 < … < y_1 < y_2 < …

(Обоснуйте своё число вершин в зависимости от n и порядка.)

---

#### Решение

F_n = (x₁ → y₁) ∧ (x₂ → y₂) ∧ ... ∧ (xₙ → yₙ)

Каждый конъюнкт xᵢ → yᵢ = ¬xᵢ ∨ yᵢ.

**a) Порядок x₁ < y₁ < x₂ < y₂ < ...**

При таком порядке каждая пара (xᵢ, yᵢ) обрабатывается последовательно.

Для одной пары xᵢ → yᵢ:
- Если xᵢ = 0: результат 1 (независимо от yᵢ)
- Если xᵢ = 1: результат = yᵢ

BDD для xᵢ → yᵢ имеет 3 вершины (не считая терминалы): xᵢ, yᵢ, и выходы.

Для n пар последовательно:
- На уровне xᵢ: 1 вершина
- На уровне yᵢ: 1 вершина (только при xᵢ = 1)

**Число вершин:** 2n + 2 (терминалы 0 и 1)

Или без терминалов: **2n внутренних вершин**

---

**b) Порядок x₁ < x₂ < ... < xₙ < y₁ < y₂ < ... < yₙ**

Все x сначала, потом все y.

После обработки всех x мы имеем 2ⁿ путей (все комбинации значений x).

Каждый путь определяет, какие yᵢ нужны для результата:
- Если xᵢ = 0, то yᵢ не влияет
- Если xᵢ = 1, то нужно yᵢ = 1

На уровне y нужно проверить только те yᵢ, где xᵢ = 1.

**Число вершин экспоненциально растёт!**

На уровне xᵢ: число вершин может расти.

Грубая оценка: O(2ⁿ) вершин.

Более точно: на уровне каждого xᵢ удваивается число путей, но не все ведут к разным поддеревьям.

**Число вершин:** примерно **2^(n+1) - 1** или O(2ⁿ)

---

**Ответ:**
- a) Линейное: **2n** внутренних вершин
- b) Экспоненциальное: **O(2ⁿ)** вершин

---

### Задание 2 (10 баллов)
Узника подвели к двум комнатам, в каждой из которых может оказаться либо принцесса, либо тигр. На каждой из комнат прикреплены таблички. На первой написано: «Либо в этой комнате сидит тигр, либо принцесса находится в другой комнате». На второй: «Принцесса в другой комнате». Дополнительно известно, что либо оба утверждения истинны, либо оба утверждения ложны. С помощью формальных методов определите, в какой комнате находится принцесса.

---

#### Решение

**Обозначения:**
- P₁ — принцесса в комнате 1
- P₂ — принцесса в комнате 2
- T₁ — тигр в комнате 1 (T₁ = ¬P₁)
- T₂ — тигр в комнате 2 (T₂ = ¬P₂)

**Таблички:**
- S₁: "Либо тигр в этой комнате (1), либо принцесса в другой комнате (2)"
  S₁ = T₁ ∨ P₂ = ¬P₁ ∨ P₂
- S₂: "Принцесса в другой комнате (1)"
  S₂ = P₁

**Условие:** S₁ ↔ S₂ (оба истинны или оба ложны)

**Анализ:**

S₁ ↔ S₂ = (¬P₁ ∨ P₂) ↔ P₁

Раскроем эквивалентность:
(¬P₁ ∨ P₂) ↔ P₁ = ((¬P₁ ∨ P₂) → P₁) ∧ (P₁ → (¬P₁ ∨ P₂))

Первая часть: (¬P₁ ∨ P₂) → P₁ = ¬(¬P₁ ∨ P₂) ∨ P₁ = (P₁ ∧ ¬P₂) ∨ P₁ = P₁

Вторая часть: P₁ → (¬P₁ ∨ P₂) = ¬P₁ ∨ ¬P₁ ∨ P₂ = ¬P₁ ∨ P₂

Итого: P₁ ∧ (¬P₁ ∨ P₂)

Это эквивалентно: P₁ ∧ (¬P₁ ∨ P₂) = (P₁ ∧ ¬P₁) ∨ (P₁ ∧ P₂) = P₁ ∧ P₂

**Вывод:** P₁ = 1 и P₂ = 1
Это решение (две принцессы) возможно, если условия задачи допускают нахождение принцесс в обеих комнатах.
Однако, часто в таких задачах подразумевается **исключающее ИЛИ** ("Либо... либо...").

**Альтернативный вариант (XOR):**
Пусть "Либо А, либо Б" означает строгую дизъюнкцию ($\oplus$).
$S_1 = T_1 \oplus P_2 = \neg P_1 \oplus P_2$
$S_1 \leftrightarrow S_2 \implies (\neg P_1 \oplus P_2) \leftrightarrow P_1$

1) Если $P_1 = 1$:
   $(\neg 1 \oplus P_2) \leftrightarrow 1$
   $(0 \oplus P_2) = 1 \implies P_2 = 1$
2) Если $P_1 = 0$:
   $(\neg 0 \oplus P_2) \leftrightarrow 0$
   $(1 \oplus P_2) = 0 \implies P_2 = 1$

В обоих случаях $P_2 = 1$ (Принцесса во 2-й комнате).
$P_1$ может быть 0 или 1.
Поскольку обычно ищется **одна** принцесса, то $P_2=1 \implies P_1=0$.

**Ответ:** Принцесса находится во **второй** комнате.

--- 

Перечитаем условие: "в каждой из которых может оказаться либо принцесса, либо тигр" — значит, ровно одно существо в каждой комнате.

Если P₁ ∧ P₂ — обе принцессы, это возможно по условию задачи!

Но обычно в таких задачах одна принцесса. Проверим таблицу:

| P₁ | P₂ | S₁ = ¬P₁ ∨ P₂ | S₂ = P₁ | S₁ ↔ S₂ |
|----|----|----|----|----|
| 0 | 0 | 1 | 0 | 0 |
| 0 | 1 | 1 | 0 | 0 |
| 1 | 0 | 0 | 1 | 0 |
| 1 | 1 | 1 | 1 | 1 |

Единственное решение: P₁ = 1, P₂ = 1.

**Ответ:** Принцесса в **обеих комнатах** (или задача имеет одну принцессу — тогда **в комнате 1**, если P₂ невозможно).

При стандартном условии "одна принцесса": **комната 1**.

---

### Задание 3 (10 баллов)
Формализуйте следующие правила (звонки могут быть входящими или исходящими). Какие из правил эквивалентны между собой?

a) Все входящие звонки бесплатны.

b) Все исходящие звонки платные.

c) Все бесплатные звонки не входящие.

d) Любой платный звонок — входящий.

e) Неверно, что некоторые входящие звонки — платные.

f) Ни один не исходящий звонок не является платным.

(Дайте формальные формулировки и установите эквивалентности.)

---

#### Решение

**Обозначения:**
- V(x) — x входящий звонок
- I(x) — x исходящий звонок (I = ¬V, если звонок либо входящий, либо исходящий)
- B(x) — x бесплатный
- P(x) — x платный (P = ¬B)

**Формализация:**

a) ∀x (V(x) → B(x)) — все входящие бесплатны

b) ∀x (I(x) → P(x)) = ∀x (¬V(x) → ¬B(x)) — все исходящие платные

c) ∀x (B(x) → ¬V(x)) = ∀x (B(x) → I(x)) — все бесплатные не входящие (исходящие)

d) ∀x (P(x) → V(x)) = ∀x (¬B(x) → V(x)) — платные входящие

e) ¬∃x (V(x) ∧ P(x)) = ∀x (V(x) → ¬P(x)) = ∀x (V(x) → B(x)) — нет входящих платных

f) ∀x (¬I(x) → ¬P(x)) = ∀x (V(x) → B(x)) — не исходящие не платные

**Проверка эквивалентностей:**

- **a) ≡ e) ≡ f)**: Все три формулы эквивалентны ∀x (V(x) → B(x))

- **b)**: ∀x (¬V(x) → ¬B(x)) — контрапозиция: ∀x (B(x) → V(x))

- **c)**: ∀x (B(x) → ¬V(x)) — это ∀x (B(x) → I(x))

- **d)**: ∀x (¬B(x) → V(x)) — контрапозиция: ∀x (¬V(x) → B(x)) = ∀x (I(x) → B(x))

**Сравнение:**
- b) говорит: B → V (бесплатные входящие)
- c) говорит: B → ¬V (бесплатные не входящие)
- d) говорит: I → B (исходящие бесплатные)

b) и c) **противоречат** друг другу (кроме случая, когда нет бесплатных).

b) и d) **противоречат** друг другу.

**Ответ:**

Эквивалентны: **a) ≡ e) ≡ f)**

Все три выражают: "Все входящие звонки бесплатны" = ∀x (V(x) → B(x))

---

### Задание 4 (10 баллов)
Найдите слабейшее предусловие для программы:

if x < 0 then y := x + 1 else y := x - 1 fi

при постусловии { y > 2 }.

---

#### Решение

**Программа:**
```
if x < 0 then y := x + 1 else y := x - 1 fi
```

**Постусловие:** y > 2

**Метод wp для условного оператора:**

wp(if B then S₁ else S₂, Q) = (B → wp(S₁, Q)) ∧ (¬B → wp(S₂, Q))

Или эквивалентно: (B ∧ wp(S₁, Q)) ∨ (¬B ∧ wp(S₂, Q))

**Вычисление:**

B = (x < 0)
S₁ = "y := x + 1"
S₂ = "y := x - 1"
Q = (y > 2)

wp(S₁, Q) = wp("y := x + 1", y > 2) = (x + 1 > 2) = (x > 1)

wp(S₂, Q) = wp("y := x - 1", y > 2) = (x - 1 > 2) = (x > 3)

**Слабейшее предусловие:**

wp = (x < 0 → x > 1) ∧ (x ≥ 0 → x > 3)

Первая часть: x < 0 → x > 1 = ¬(x < 0) ∨ (x > 1) = (x ≥ 0) ∨ (x > 1)

При x < 0: нужно x > 1, но x < 0 и x > 1 несовместны. Значит, x < 0 делает первую импликацию истинной при x > 1, но x < 0 и x > 1 — пусто.

Упростим: x < 0 → x > 1 эквивалентно x ≥ 0 ∨ x > 1 = x ≥ 0 (т.к. x > 1 ⊂ x ≥ 0... нет, это неверно, x > 1 не включает x ∈ [0, 1])

На самом деле: x < 0 → x > 1 истинно когда ¬(x < 0) ∨ (x > 1) = (x ≥ 0) ∨ (x > 1) = x ≥ 0 ∨ x > 1

Это истинно для x ≥ 0 (тогда первый дизъюнкт истинен) и для x > 1 (тогда второй истинен).

При x < 0: (x ≥ 0) = 0, (x > 1) = 0, итого 0.

Значит, первая часть (x < 0 → x > 1) ложна при x < 0 и x ≤ 1, т.е. при x < 0.

**Альтернативная форма:**

wp = (x < 0 ∧ x > 1) ∨ (x ≥ 0 ∧ x > 3)

Первый дизъюнкт: x < 0 ∧ x > 1 = false (противоречие)

Второй дизъюнкт: x ≥ 0 ∧ x > 3 = x > 3

**Слабейшее предусловие:** **x > 3**

---

### Задание 5 (15 баллов)
Выразите формулой LTL следующие свойства бесконечных вычислений (в каждом состоянии выполняется не более одного события):

a) После события p в следующий момент обязательно произойдёт событие q. (т.е. X q, когда p текущем)

b) Событие p выполняется в каждый чётный момент времени и не выполняется в каждый нечётный момент времени.

c) Событие p выполняется в каждый чётный момент времени.

---

#### Решение

**a) После p в следующий момент обязательно q**

**Формула:** G(p → X q)

Расшифровка: всегда, если сейчас p, то в следующем состоянии q.

---

**b) p в каждый чётный момент, ¬p в каждый нечётный**

Моменты: s₀, s₁, s₂, s₃, ...
- Чётные (0, 2, 4, ...): p = 1
- Нечётные (1, 3, 5, ...): p = 0

Паттерн: p, ¬p, p, ¬p, p, ¬p, ...

**Формула:** p ∧ G(p ↔ X ¬p)

Или: p ∧ G(p → X ¬p) ∧ G(¬p → X p)

Расшифровка: начинаем с p, и всегда значение p меняется на противоположное.

---

**c) p в каждый чётный момент времени**

Моменты: s₀, s₁, s₂, s₃, ...
- Чётные (0, 2, 4, ...): p = 1
- Нечётные: p любое (не указано)

**Формула:** p ∧ G(p → X X p)

Расшифровка: начинаем с p, и если сейчас p, то через 2 шага тоже p.

Но это не гарантирует p в чётные, если p пропущено.

Более точно: **p ∧ G X X p** — но это p ∧ G(X X p) = p ∧ X X p ∧ X X X X p ∧ ... — это не работает.

Корректная формула: **G(X X p)** не выражает "p в чётные".

Используем паттерн: p ∧ X ? ∧ X X p ∧ X X X ? ∧ ...

**Формула:** p ∧ G(X X p → X X X X p)... это сложно.

Проще: **p ∧ G(p → X X p) ∧ G(X ¬p → X X X ¬p)** — но это не то.

**Упрощённый ответ:** G((even → p)), но "even" не выразимо напрямую.

Практичная формула: **p ∧ X X p ∧ X X X X p ∧ ...** — бесконечная конъюнкция.

Для LTL: **p ∧ G(X X p)** — это неверно, т.к. G(X X p) = X X G p...

**Финальный ответ:** p ∧ G(true → X X p) не подходит.

Корректно: **p ∧ G X X p** интерпретируется как p ∧ G(X(X p)), что даёт p в позициях 0, 2, 4, ...? Нет, G X X p означает "всегда через 2 шага p" ≠ "p в чётные".

**Ответ c):** G(даже → p) нельзя выразить простой формулой LTL. Приближение: **p ∧ X X p ∧ G(X X(p ∨ ¬p))** не работает.

Оставим: **p ∧ G(p → X X p)** — p в начале и если p, то через 2 шага p.

---

### Задание 6 (10 баллов)
Для заданной структуры Крипке M проверьте выполнение свойства её поведения непосредственно по развертке вычислений M:

EG ( on ⇒ XXX off )

Ответ должен содержать развертку и пример вычисления (укажите, в каком состоянии выполняется формула).

| from \\ to | on | off |
|---:|:-:|:-:|
| **on**  | 1 | 1 |
| **off** | 1 | 1 |

---

#### Решение

**Структура Крипке:**

Состояния: on, off
Переходы: on → on, on → off, off → on, off → off

**Формула: EG(on → X X X off)**

Требуется: существует путь, на котором всегда выполняется (on → X X X off).

**Анализ формулы on → X X X off:**

"Если сейчас on, то через 3 шага off."

**Развёртка и поиск пути:**

Ищем бесконечный путь, где в каждом состоянии выполняется импликация.

**Путь 1:** off → off → off → off → ...

- В каждом состоянии: on = 0, импликация 0 → ? = 1 ✓

Формула EG(on → X X X off) **выполняется** на этом пути!

**Путь 2:** on → ? → ? → off → on → ...

- s₀ = on: нужно s₃ = off. Путь: on → ? → ? → off
- s₃ = off: импликация выполнена (on = 0)
- Нужно продолжить бесконечно...

Путь: on → on → on → off → on → on → on → off → ...

Проверим:
- s₀ = on: X X X off = s₃ = off ✓
- s₁ = on: X X X off = s₄ = on ≠ off ✗

Этот путь не подходит.

**Путь 3:** off → off → off → off → ... (петля в off)

Все состояния off, импликация всегда истинна.

**Ответ:**

Формула **EG(on → X X X off) выполняется**.

**Путь-свидетель:** off → off → off → off → ... (бесконечная петля в off)

В состоянии **off** формула EG(on → X X X off) выполняется.

В состоянии **on** формула также может выполняться, если выбрать путь on → off → off → off → ...:
- s₀ = on: X X X off = off ✓
- s₁, s₂, ... = off: импликация истинна ✓